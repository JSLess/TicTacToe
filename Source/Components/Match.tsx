
export type { Args as MatchArgs }
export { Component as Match }

import { User, UserInMatch } from 'State'
import { Style } from 'Misc';
import { JSX } from 'preact';
import { render } from 'Preact/Render';
import { Isolate } from '../Misc/Isolate.tsx';
import { FieldLink } from 'UI/Parts';


const Stylesheet = Style /* CSS */ `

    :root {
        --Symbol-X : polygon( 3.125% 0%,3.125% 0%,2.878% 0.01%,2.633% 0.039%,2.393% 0.087%,2.158% 0.154%,1.929% 0.239%,1.707% 0.341%,1.494% 0.461%,1.29% 0.597%,1.097% 0.75%,0.915% 0.918%,0.915% 0.918%,0.586% 1.305%,0.33% 1.729%,0.147% 2.179%,0.037% 2.648%,0.001% 3.126%,0.037% 3.604%,0.147% 4.073%,0.33% 4.524%,0.586% 4.948%,0.915% 5.336%,45.581% 50.001%,0.915% 94.667%,0.915% 94.667%,0.586% 95.054%,0.33% 95.478%,0.147% 95.928%,0.037% 96.397%,0.001% 96.875%,0.037% 97.353%,0.147% 97.822%,0.33% 98.273%,0.586% 98.697%,0.915% 99.085%,0.915% 99.085%,1.302% 99.413%,1.726% 99.669%,2.177% 99.851%,2.646% 99.961%,3.124% 99.997%,3.602% 99.961%,4.071% 99.851%,4.522% 99.669%,4.946% 99.413%,5.333% 99.085%,49.999% 54.419%,94.664% 99.085%,94.664% 99.085%,95.052% 99.414%,95.475% 99.67%,95.926% 99.853%,96.395% 99.963%,96.873% 99.999%,97.352% 99.963%,97.821% 99.853%,98.273% 99.67%,98.697% 99.414%,99.085% 99.085%,99.085% 99.085%,99.413% 98.697%,99.669% 98.273%,99.851% 97.822%,99.961% 97.353%,99.997% 96.875%,99.961% 96.397%,99.851% 95.928%,99.669% 95.478%,99.413% 95.054%,99.085% 94.667%,54.419% 50.001%,99.085% 5.336%,99.085% 5.336%,99.413% 4.948%,99.669% 4.524%,99.851% 4.073%,99.961% 3.604%,99.997% 3.126%,99.961% 2.648%,99.851% 2.179%,99.669% 1.729%,99.413% 1.305%,99.085% 0.918%,99.085% 0.918%,98.697% 0.589%,98.273% 0.333%,97.822% 0.15%,97.353% 0.04%,96.875% 0.004%,96.397% 0.04%,95.928% 0.15%,95.478% 0.333%,95.054% 0.589%,94.667% 0.918%,50.001% 45.584%,5.336% 0.918%,5.336% 0.918%,5.153% 0.75%,4.96% 0.597%,4.756% 0.461%,4.542% 0.341%,4.321% 0.239%,4.092% 0.154%,3.857% 0.087%,3.616% 0.039%,3.372% 0.01%,3.124% 0% ) ;
        --Symbol-O : polygon( 50.001% 0%,50.001% 0%,41.9% 0.655%,34.212% 2.553%,27.04% 5.588%,20.488% 9.658%,14.659% 14.659%,9.658% 20.487%,5.588% 27.039%,2.553% 34.211%,0.655% 41.9%,0% 50.001%,0% 50.001%,0.655% 58.103%,2.553% 65.791%,5.588% 72.963%,9.658% 79.515%,14.659% 85.344%,20.487% 90.345%,27.039% 94.415%,34.211% 97.45%,41.9% 99.347%,50.001% 100.003%,50.001% 100.003%,58.103% 99.348%,65.791% 97.45%,72.963% 94.415%,79.515% 90.345%,85.344% 85.344%,90.345% 79.516%,94.415% 72.964%,97.45% 65.792%,99.347% 58.103%,100.003% 50.001%,100.003% 50.001%,99.348% 41.9%,97.45% 34.212%,94.415% 27.04%,90.345% 20.488%,85.344% 14.659%,79.516% 9.658%,72.964% 5.588%,65.792% 2.553%,58.103% 0.655%,50.001% 0%,50.001% 6.252%,50.001% 6.252%,57.107% 6.823%,63.844% 8.478%,70.123% 11.128%,75.855% 14.682%,80.95% 19.051%,85.319% 24.146%,88.873% 29.878%,91.522% 36.157%,93.178% 42.894%,93.749% 49.999%,93.749% 49.999%,93.177% 57.104%,91.522% 63.841%,88.873% 70.12%,85.319% 75.852%,80.949% 80.948%,75.854% 85.317%,70.122% 88.871%,63.843% 91.52%,57.106% 93.175%,50.001% 93.747%,50.001% 93.747%,42.896% 93.175%,36.159% 91.52%,29.88% 88.871%,24.148% 85.317%,19.053% 80.947%,14.684% 75.852%,11.13% 70.12%,8.481% 63.841%,6.825% 57.104%,6.254% 49.999%,6.254% 49.999%,6.825% 42.894%,8.481% 36.157%,11.13% 29.878%,14.684% 24.146%,19.053% 19.051%,24.149% 14.681%,29.881% 11.127%,36.16% 8.478%,42.896% 6.823%,50.001% 6.252% ) ;
    }

    .Grid {
        display : grid ;
    }

    .Grid > * {
        grid-area : 1 / 1 ;
    }

    .Fields {
        grid-template-columns : repeat( 3 , 1fr ) ;
        grid-template-rows : repeat( 3 , 1fr ) ;
        display : grid ;
    }

    .Fields > * {

        position : relative ;

        transition : opacity 200ms ;

        padding : 0.5rem ;
        margin : 0.9rem ;

        aspect-ratio : 1 ;
        width : min( 10vw , 10vh ) ;

        opacity : 0.8 ;
    }

    .Fields > *:hover {
        cursor : pointer ;
        opacity : 1 ;
    }

    .Fields > *[ data-shape = X ] {
        background : #975f16ad ;
        clip-path : var( --Symbol-X ) ;
        opacity : 1 ;
    }

    .Fields > *[ data-shape = O ] {
        background : #30517bb5 ;
        clip-path : var( --Symbol-O ) ;
        opacity : 1 ;
    }

    .Horizontal {
        grid-template-rows : repeat( 3 , 1fr ) ;
        align-items : end ;
        display : grid ;
    }

    .Horizontal > * {
        border-radius : 100vw ;
        background : #bbbbbb ;
        translate : 0.25rem 50% ;
        height : 0.5rem ;
        width : calc( 100% - 0.5rem ) ;
    }

    .Vertical {
        grid-template-columns : repeat( 3 , 1fr ) ;
        justify-items : end ;
        display : grid ;
    }

    .Vertical > * {
        border-radius : 100vw ;
        background : #bbbbbb ;
        translate : 50% 0.25rem ;
        height : calc( 100% - 0.5rem ) ;
        width : 0.5rem ;
    }

`


interface Args {
    user : UserInMatch & User
}


function Component (
    { user } : Args
){

    const elements = new Array<JSX.Element>

    for ( let y = 0 ; y < 3 ; y++ )
        for ( let x = 0 ; x < 3 ; x++ )
            elements.push(

                <Isolate
                    data-y = { y }
                    data-x = { x }
                    height = '100%'
                    width = '100%'
                >
                    <FieldLink
                        y = { y }
                        x = { x }
                    />
                </Isolate>
            )


    const symbol = ( user.match.users.indexOf(user.userRef) === 1 ) ? 'X' : 'O'

    const { fields } = user.match

    return <>

        <Stylesheet />

        { Style /* CSS */ `

            .Fields > *:hover::after {
                background : #bbbbbb ;
                clip-path : var( --Symbol-${ symbol } ) ;
                content : '' ;
                position : absolute ;
                inset : 0 ;
            }

        `() }

        <div class = 'Grid' >

            <div class = 'Horizontal' >
                <div />
                <div />
            </div>

            <div class = 'Vertical' >
                <div />
                <div />
            </div>

            <div class = 'Fields' >
                { elements }
            </div>

        </div>
    </>
}
